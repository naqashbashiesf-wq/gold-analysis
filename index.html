<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªØ­Ù„ÛŒÙ„ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ØŒ Ù†Ù‚Ø±Ù‡ØŒ Ø¯Ù„Ø§Ø± Ùˆ Ø§Ø±Ø² - Ú¯Ù„Ø¯ÛŒØ§Ø±">
    <meta name="keywords" content="Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ØŒ Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø±ØŒ ØªØ­Ù„ÛŒÙ„ Ø·Ù„Ø§ØŒ Ù…Ø«Ù‚Ø§Ù„ØŒ Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø±">
    <title>Ú¯Ù„Ø¯ÛŒØ§Ø± - Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’°</text></svg>">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Vazirmatn', sans-serif; 
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        .price-up {
            animation: priceUp 0.5s ease;
        }
        .price-down {
            animation: priceDown 0.5s ease;
        }
        @keyframes priceUp {
            0% { background-color: transparent; }
            50% { background-color: rgba(34, 197, 94, 0.2); }
            100% { background-color: transparent; }
        }
        @keyframes priceDown {
            0% { background-color: transparent; }
            50% { background-color: rgba(239, 68, 68, 0.2); }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body class="antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§
        const RefreshIcon = ({className}) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        const TrendingUpIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
        );

        const TrendingDownIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
            </svg>
        );

        const ChartIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
        );

        const BellIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
        );

        const GoldPriceTracker = () => {
            const [goldPrice, setGoldPrice] = useState(4330);
            const [usdRate, setUsdRate] = useState(1355000);
            const [mesghalMarket, setMesghalMarket] = useState(625000000);
            const [geram18Market, setGeram18Market] = useState(147500000);
            const [dirhamRate, setDirhamRate] = useState(369000);
            const [uaeGoldPrice, setUaeGoldPrice] = useState(372);
            const [lastUpdate, setLastUpdate] = useState(new Date());
            const [isLoading, setIsLoading] = useState(false);
            const [dataSource, setDataSource] = useState('Metals.live');
            const prevGoldPrice = useRef(goldPrice);

            // ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± (Ø¢Ø®Ø±ÛŒÙ† 50 Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ)
            const [priceHistory, setPriceHistory] = useState([]);

            // Ø¢Ø³ØªØ§Ù†Ù‡ Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª Ø§Ù†Ø³ Ø·Ù„Ø§
            const [alertThreshold, setAlertThreshold] = useState(4400);
            const [showAlertModal, setShowAlertModal] = useState(false);

            const MESGHAL_DIVIDER = 9.5742;
            const GRAM_PER_OUNCE = 31.1035;

            // Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ø¬Ù‡Ø§Ù†ÛŒ Ø·Ù„Ø§
            const fetchGoldPrice = async () => {
                try {
                    const response = await fetch('https://api.metals.live/v1/spot/gold');
                    const data = await response.json();
                    if (data && data[0] && data[0].price) {
                        prevGoldPrice.current = goldPrice;
                        setGoldPrice(data[0].price);
                        setDataSource('Metals.live - ÙˆØ§Ù‚Ø¹ÛŒ');
                    }
                } catch (error) {
                    console.log('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ø·Ù„Ø§:', error);
                }
            };

            // Ø¨Ø±Ø§ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒØŒ Ø§Ø² Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… (Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª API Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯)
            const simulateIranianPrices = () => {
                setUsdRate(prev => prev + (Math.random() - 0.5) * 5000);
                setMesghalMarket(prev => prev + (Math.random() - 0.5) * 1000000);
                setGeram18Market(prev => prev + (Math.random() - 0.5) * 300000);
            };

            useEffect(() => {
                fetchGoldPrice();
                simulateIranianPrices();

                const interval = setInterval(() => {
                    fetchGoldPrice();
                    simulateIranianPrices();
                    setLastUpdate(new Date());

                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ù…ÙˆØ¯Ø§Ø±
                    setPriceHistory(prev => {
                        const newHistory = [...prev, { time: new Date().toLocaleTimeString('fa-IR'), price: goldPrice }];
                        return newHistory.slice(-50); // ÙÙ‚Ø· 50 Ù†Ù‚Ø·Ù‡ Ø¢Ø®Ø±
                    });

                    // Ú†Ú© Ù‡Ø´Ø¯Ø§Ø±
                    if (goldPrice >= alertThreshold) {
                        setShowAlertModal(true);
                        new Notification('Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª Ø·Ù„Ø§!', {
                            body: `Ù‚ÛŒÙ…Øª Ø§Ù†Ø³ Ø·Ù„Ø§ Ø¨Ù‡ ${goldPrice.toFixed(2)} Ø¯Ù„Ø§Ø± Ø±Ø³ÛŒØ¯!`,
                            icon: 'ğŸ’°'
                        });
                    }
                }, 30000);

                // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }

                return () => clearInterval(interval);
            }, [goldPrice, alertThreshold]);

            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆØ¯Ø§Ø± Ø¨Ø§ Chart.js
            useEffect(() => {
                if (priceHistory.length < 2) return;

                const ctx = document.getElementById('goldChart').getContext('2d');
                if (window.goldChartInstance) window.goldChartInstance.destroy();

                window.goldChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: priceHistory.map(h => h.time),
                        datasets: [{
                            label: 'Ù‚ÛŒÙ…Øª Ø§Ù†Ø³ Ø·Ù„Ø§ (Ø¯Ù„Ø§Ø±)',
                            data: priceHistory.map(h => h.price),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(251, 191, 36, 0.2)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { beginAtZero: false }
                        }
                    }
                });
            }, [priceHistory]);

            const handleRefresh = async () => {
                setIsLoading(true);
                await fetchGoldPrice();
                simulateIranianPrices();
                setTimeout(() => setIsLoading(false), 500);
            };

            const formatNumber = (num) => {
                return new Intl.NumberFormat('fa-IR').format(Math.round(num));
            };

            const getPriceChangeClass = () => {
                if (goldPrice > prevGoldPrice.current) return "price-up";
                if (goldPrice < prevGoldPrice.current) return "price-down";
                return "";
            };

            // Ù…Ø­Ø§Ø³Ø¨Ø§Øª ØªØ­Ù„ÛŒÙ„ (Ù‡Ù…Ø§Ù† Ù‚Ø¨Ù„ÛŒ)
            const mesghalTheo = (goldPrice * usdRate) / MESGHAL_DIVIDER;
            const diffMesghal = mesghalTheo - mesghalMarket;

            const geram18Theo = ((goldPrice / GRAM_PER_OUNCE) * usdRate) * 0.75;
            const diffGeram18 = geram18Theo - geram18Market;

            const realValueDirham = dirhamRate * uaeGoldPrice;
            const diffDirham = realValueDirham - geram18Market;

            return (
                <div className="min-h-screen pb-20">
                    {/* Header Ùˆ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù‡Ù…Ø§Ù† Ú©Ø¯ Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ */}

                    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
                        {/* Ú©Ø§Ø±Øª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ */}
                        <div className="glass-effect rounded-2xl p-4 shadow-xl">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="text-sm font-bold text-gray-700 flex items-center gap-2">
                                    <span className="pulse-animation inline-block w-2 h-2 bg-green-500 rounded-full"></span>
                                    Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ ({dataSource})
                                </h3>
                                <button onClick={handleRefresh} className="p-2 bg-yellow-500 text-white rounded-xl">
                                    <RefreshIcon className={`w-4 h-4 ${isLoading ? 'animate-spin' : ''}`} />
                                </button>
                            </div>

                            <div className={`bg-white bg-opacity-60 rounded-xl p-3 border-r-4 border-yellow-600 ${getPriceChangeClass()}`}>
                                <span className="text-xs text-gray-600 block mb-1">Ø§Ù†Ø³ Ø·Ù„Ø§ ğŸŒ</span>
                                <div className="text-lg font-bold text-gray-800">${goldPrice.toFixed(2)}</div>
                            </div>

                            {/* Ø¯ÛŒÚ¯Ø± Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§... */}

                            <div className="mt-3 text-center text-xs text-gray-600">
                                Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: {lastUpdate.toLocaleTimeString('fa-IR')}
                            </div>
                        </div>

                        {/* Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚ÛŒÙ…Øª (ÙˆÛŒÚ˜Ú¯ÛŒ premium Ø¯Ù…Ùˆ) */}
                        <div className="bg-white rounded-2xl shadow-xl p-4">
                            <div className="flex items-center gap-2 mb-4">
                                <ChartIcon />
                                <h3 className="font-bold text-gray-800">Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚ÛŒÙ…Øª Ø§Ù†Ø³ Ø·Ù„Ø§ (ÛµÛ° Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ø®Ø±)</h3>
                            </div>
                            <canvas id="goldChart" height="200"></canvas>
                        </div>

                        {/* Ù‡Ø´Ø¯Ø§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ (Ø¯Ù…Ùˆ) */}
                        <div className="bg-white rounded-2xl shadow-xl p-4">
                            <div className="flex items-center gap-2 mb-4">
                                <BellIcon />
                                <h3 className="font-bold text-gray-800">Ù‡Ø´Ø¯Ø§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‚ÛŒÙ…Øª</h3>
                            </div>
                            <div className="flex items-center gap-3">
                                <input 
                                    type="number" 
                                    value={alertThreshold} 
                                    onChange={(e) => setAlertThreshold(Number(e.target.value))}
                                    className="px-4 py-2 border rounded-xl w-32 text-center"
                                    placeholder="Ø¢Ø³ØªØ§Ù†Ù‡"
                                />
                                <span className="text-gray-600">Ø¯Ù„Ø§Ø± - Ø§Ú¯Ø± Ù‚ÛŒÙ…Øª Ø¨ÛŒØ´ØªØ± Ø´Ø¯ØŒ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø¯Ù‡</span>
                            </div>
                        </div>

                        {/* Ù…Ø¯Ø§Ù„ Ù‡Ø´Ø¯Ø§Ø± */}
                        {showAlertModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-2xl p-6 text-center shadow-2xl">
                                    <div className="text-5xl mb-4">ğŸ””</div>
                                    <h2 className="text-xl font-bold text-red-600">Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…Øª!</h2>
                                    <p className="mt-2">Ù‚ÛŒÙ…Øª Ø§Ù†Ø³ Ø·Ù„Ø§ Ø¨Ù‡ {goldPrice.toFixed(2)} Ø¯Ù„Ø§Ø± Ø±Ø³ÛŒØ¯.</p>
                                    <button onClick={() => setShowAlertModal(false)} className="mt-4 px-6 py-2 bg-yellow-500 text-white rounded-xl">
                                        Ø¨Ø³ØªÙ†
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Ø¨Ù‚ÛŒÙ‡ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ Ùˆ Ø¨Ù†Ø± premium Ù‡Ù…Ø§Ù† Ú©Ø¯ Ø§ØµÙ„ÛŒ */}
                    </div>

                    {/* Bottom Navigation Ø¨Ø§ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¯Ù…Ùˆ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 shadow-2xl z-50">
                        <div className="max-w-7xl mx-auto px-4 py-3">
                            <div className="grid grid-cols-4 gap-2 text-xs">
                                <div className="flex flex-col items-center text-yellow-600">
                                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg>
                                    <span className="font-bold">Ø®Ø§Ù†Ù‡</span>
                                </div>
                                <div className="flex flex-col items-center text-gray-600">
                                    <ChartIcon />
                                    <span>Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ (ÙØ¹Ø§Ù„)</span>
                                </div>
                                <div className="flex flex-col items-center text-gray-600">
                                    <BellIcon />
                                    <span>Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ (ÙØ¹Ø§Ù„)</span>
                                </div>
                                <div className="flex flex-col items-center text-gray-600">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 14l9-5-9-5-9 5 9 5z" /></svg>
                                    <span>Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ AI</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<GoldPriceTracker />, document.getElementById('root'));
    </script>
</body>
</html>
